{
  "stage": "testgen",
  "project_root": "C:\\Users\\lenovo\\Desktop\\Diagramscene_ultima-main",
  "created_at": "20251217_223156",
  "meta": {
    "project_root": "C:\\Users\\lenovo\\Desktop\\Diagramscene_ultima-main",
    "llm_output": {
      "out_dir": "tests\\generated",
      "files": [
        "tests/generated/test_diagram_items.cpp",
        "tests/generated/test_diagram_items.pro",
        "tests/generated/test_commands.cpp",
        "tests/generated/tests.pro",
        "tests/generated/test_diagramitem.cpp",
        "tests/generated/test_deletecommand.cpp",
        "tests/generated/test_diagrampath.cpp",
        "tests/generated/test_findreplacedialog.cpp"
      ],
      "patches": [
        {
          "path": "tests/generated/test_diagram_items.cpp",
          "content": "#include <QtTest>\n#include <QGraphicsScene>\n#include <QMenu>\n#include <QPainter>\n#include \"../diagramitem.h\"\n#include \"../diagramtextitem.h\"\n\nclass TestDiagramItems : public QObject\n{\n    Q_OBJECT\n\nprivate slots:\n    void initTestCase();\n    void cleanupTestCase();\n    void testDiagramItemCreation();\n    void testDiagramItemBoundingRect();\n    void testDiagramItemSetBrush();\n    void testDiagramItemSetFixedSize();\n    void testDiagramTextItemCreation();\n    void testDiagramTextItemInteraction();\n    void testDiagramItemRotation();\n    void testDiagramItemTypes();\n};\n\nvoid TestDiagramItems::initTestCase()\n{\n    // 初始化代码（如果需要）\n}\n\nvoid TestDiagramItems::cleanupTestCase()\n{\n    // 清理代码（如果需要）\n}\n\nvoid TestDiagramItems::testDiagramItemCreation()\n{\n    QMenu contextMenu;\n    DiagramItem item(DiagramItem::Step, &contextMenu);\n    QVERIFY(item.parentItem() == nullptr);\n    QCOMPARE(item.diagramType(), DiagramItem::Step);\n    QVERIFY(item.flags() & QGraphicsItem::ItemIsSelectable);\n    QVERIFY(item.flags() & QGraphicsItem::ItemIsMovable);\n    QVERIFY(item.textItem != nullptr);\n}\n\nvoid TestDiagramItems::testDiagramItemBoundingRect()\n{\n    QMenu contextMenu;\n    DiagramItem item(DiagramItem::Step, &contextMenu);\n    QRectF rect = item.boundingRect();\n    QVERIFY(rect.isValid());\n    QVERIFY(!rect.isEmpty());\n    // 由于旋转和边框，边界矩形应大于初始图形大小\n    QVERIFY(rect.width() >= 150); // m_grapSize.width() = 150\n    QVERIFY(rect.height() >= 100); // m_grapSize.height() = 100\n}\n\nvoid TestDiagramItems::testDiagramItemSetBrush()\n{\n    QMenu contextMenu;\n    DiagramItem item(DiagramItem::Step, &contextMenu);\n    QColor newColor(Qt::red);\n    item.setBrush(newColor);\n    // 无法直接验证内部颜色，但可以确保函数调用不会崩溃\n    QVERIFY(true);\n}\n\nvoid TestDiagramItems::testDiagramItemSetFixedSize()\n{\n    QMenu contextMenu;\n    DiagramItem item(DiagramItem::Step, &contextMenu);\n    QSizeF newSize(200, 150);\n    item.setFixedSize(newSize);\n    QRectF rect = item.boundingRect();\n    // 边界矩形应反映新尺寸（考虑旋转和边框）\n    QVERIFY(rect.width() >= 200);\n    QVERIFY(rect.height() >= 150);\n}\n\nvoid TestDiagramItems::testDiagramTextItemCreation()\n{\n    DiagramTextItem textItem;\n    QVERIFY(textItem.parentItem() == nullptr);\n    QVERIFY(textItem.flags() & QGraphicsItem::ItemIsSelectable);\n    QVERIFY(textItem.flags() & QGraphicsItem::ItemIsMovable);\n    QCOMPARE(textItem.textInteractionFlags(), Qt::TextEditorInteraction);\n}\n\nvoid TestDiagramItems::testDiagramTextItemInteraction()\n{\n    DiagramTextItem textItem;\n    // 测试焦点丢失后交互标志被重置\n    textItem.setTextInteractionFlags(Qt::TextEditorInteraction);\n    // 模拟焦点丢失（无法直接模拟，但验证初始状态）\n    QCOMPARE(textItem.textInteractionFlags(), Qt::TextEditorInteraction);\n    // 测试双击事件应重新启用编辑（通过标志检查）\n    textItem.setTextInteractionFlags(Qt::NoTextInteraction);\n    // 注意：无法直接调用mouseDoubleClickEvent，但验证逻辑路径\n    QVERIFY(true);\n}\n\nvoid TestDiagramItems::testDiagramItemRotation()\n{\n    QMenu contextMenu;\n    DiagramItem item(DiagramItem::Step, &contextMenu);\n    qreal initialRotation = item.rotationAngle();\n    QCOMPARE(initialRotation, 0.0);\n    \n    item.setRotationAngle(45.0);\n    QCOMPARE(item.rotationAngle(), 45.0);\n    \n    item.setRotationAngle(-30.0);\n    QCOMPARE(item.rotationAngle(), -30.0);\n    \n    // 旋转后边界矩形应仍然有效\n    QRectF rect = item.boundingRect();\n    QVERIFY(rect.isValid());\n}\n\nvoid TestDiagramItems::testDiagramItemTypes()\n{\n    QMenu contextMenu;\n    // 测试所有图形类型是否能被创建\n    QList<DiagramItem::DiagramType> types = {\n        DiagramItem::StartEnd,\n        DiagramItem::Conditional,\n        DiagramItem::Step,\n        DiagramItem::circular,\n        DiagramItem::Document,\n        DiagramItem::PredefinedProcess,\n        DiagramItem::StoredData\n    };\n    \n    for (DiagramItem::DiagramType type : types) {\n        DiagramItem item(type, &contextMenu);\n        QCOMPARE(item.diagramType(), type);\n        QVERIFY(item.boundingRect().isValid());\n    }\n}\n\nQTEST_MAIN(TestDiagramItems)\n#include \"test_diagram_items.moc\"\n"
        },
        {
          "path": "tests/generated/test_diagram_items.pro",
          "content": "QT += testlib widgets\nTEMPLATE = app\nTARGET = test_diagram_items\nCONFIG += console\nCONFIG -= app_bundle\nCONFIG += c++17\n\nSOURCES += test_diagram_items.cpp \\\n           ../diagramitem.cpp \\\n           ../diagramtextitem.cpp\n\nHEADERS += ../diagramitem.h \\\n           ../diagramtextitem.h\n\nINCLUDEPATH += ..\n\n# 注意：如果测试需要其他源文件（如arrow.cpp, diagramscene.cpp），请取消注释并添加\n# SOURCES += ../arrow.cpp \\\n#            ../diagramscene.cpp\n# HEADERS += ../arrow.h \\\n#            ../diagramscene.h\n\n# 确保资源文件（如果需要）被包含\n# RESOURCES += ../diagramscene.qrc"
        },
        {
          "path": "tests/generated/test_commands.cpp",
          "content": "#include <QtTest>\n#include <QUndoCommand>\n#include <QGraphicsScene>\n#include <QGraphicsItem>\n#include \"../deletecommand.h\"\n\nclass TestCommands : public QObject\n{\n    Q_OBJECT\n\nprivate slots:\n    void testDeleteCommandConstructor();\n    void testDeleteCommandUndoRedo();\n    void testDeleteCommandParent();\n};\n\nvoid TestCommands::testDeleteCommandConstructor()\n{\n    QGraphicsScene scene;\n    QGraphicsRectItem *item = new QGraphicsRectItem(0, 0, 100, 50);\n    scene.addItem(item);\n    QVERIFY(scene.items().contains(item));\n\n    DeleteCommand *cmd = new DeleteCommand(item, &scene);\n    QCOMPARE(cmd->text(), QString());\n    QCOMPARE(cmd->scene(), &scene);\n    QCOMPARE(cmd->item(), item);\n    delete cmd;\n    delete item;\n}\n\nvoid TestCommands::testDeleteCommandUndoRedo()\n{\n    QGraphicsScene scene;\n    QGraphicsRectItem *item = new QGraphicsRectItem(0, 0, 100, 50);\n    scene.addItem(item);\n    QVERIFY(scene.items().contains(item));\n\n    DeleteCommand cmd(item, &scene);\n    cmd.redo();\n    QVERIFY(!scene.items().contains(item));\n    cmd.undo();\n    QVERIFY(scene.items().contains(item));\n    delete item;\n}\n\nvoid TestCommands::testDeleteCommandParent()\n{\n    QGraphicsScene scene;\n    QGraphicsRectItem *item = new QGraphicsRectItem(0, 0, 100, 50);\n    scene.addItem(item);\n    QUndoCommand *parentCmd = new QUndoCommand(\"Parent Command\");\n    DeleteCommand *cmd = new DeleteCommand(item, &scene, parentCmd);\n    QCOMPARE(cmd->parent(), parentCmd);\n    delete parentCmd;\n    delete item;\n}\n\nQTEST_MAIN(TestCommands)\n#include \"test_commands.moc\""
        },
        {
          "path": "tests/generated/tests.pro",
          "content": "QT += testlib widgets\nTEMPLATE = app\nTARGET = tests\nCONFIG += console\nCONFIG -= app_bundle\nCONFIG += c++17\n\nSOURCES += \\\n    test_diagramitem.cpp \\\n    test_deletecommand.cpp \\\n    test_diagrampath.cpp \\\n    test_findreplacedialog.cpp\n\nHEADERS += \\\n    # 测试头文件\n\nINCLUDEPATH += ..\n\n# 包含被测源文件\nSOURCES += \\\n    ../diagramitem.cpp \\\n    ../deletecommand.cpp \\\n    ../diagrampath.cpp \\\n    ../findreplacedialog.cpp \\\n    ../arrow.cpp \\\n    ../diagramtextitem.cpp\n\nHEADERS += \\\n    ../diagramitem.h \\\n    ../deletecommand.h \\\n    ../diagrampath.h \\\n    ../findreplacedialog.h \\\n    ../arrow.h \\\n    ../diagramtextitem.h \\\n    ../diagramscene.h\n\n# 确保测试可找到资源（如果需要）\nRESOURCES += ../diagramscene.qrc\n\n# 测试库配置\nCONFIG += testcase\n"
        },
        {
          "path": "tests/generated/test_diagramitem.cpp",
          "content": "#include <QtTest>\n#include <QGraphicsScene>\n#include <QMenu>\n#include <QPainter>\n#include <QStyleOptionGraphicsItem>\n#include \"../diagramitem.h\"\n\nclass TestDiagramItem : public QObject\n{\n    Q_OBJECT\n\nprivate slots:\n    void initTestCase();\n    void cleanupTestCase();\n    void testConstructor();\n    void testBoundingRect();\n    void testSetBrush();\n    void testSetFixedSize();\n    void testDiagramTypeEnum();\n    void testRotationAngle();\n\nprivate:\n    QGraphicsScene *scene;\n    QMenu *contextMenu;\n};\n\nvoid TestDiagramItem::initTestCase()\n{\n    scene = new QGraphicsScene();\n    contextMenu = new QMenu();\n}\n\nvoid TestDiagramItem::cleanupTestCase()\n{\n    delete scene;\n    delete contextMenu;\n}\n\nvoid TestDiagramItem::testConstructor()\n{\n    DiagramItem item(DiagramItem::Step, contextMenu);\n    QVERIFY(item.myDiagramType == DiagramItem::Step);\n    QVERIFY(item.myContextMenu == contextMenu);\n    QVERIFY(item.rotationAngle() == 0);\n    QVERIFY(item.textItem != nullptr);\n    QCOMPARE(item.textItem->toPlainText(), QString(\"请输入\"));\n}\n\nvoid TestDiagramItem::testBoundingRect()\n{\n    DiagramItem item(DiagramItem::Step, contextMenu);\n    QRectF rect = item.boundingRect();\n    QVERIFY(rect.isValid());\n    QVERIFY(rect.width() > 0);\n    QVERIFY(rect.height() > 0);\n}\n\nvoid TestDiagramItem::testSetBrush()\n{\n    DiagramItem item(DiagramItem::Step, contextMenu);\n    QColor newColor(Qt::red);\n    item.setBrush(newColor);\n    QCOMPARE(item.m_color, newColor);\n}\n\nvoid TestDiagramItem::testSetFixedSize()\n{\n    DiagramItem item(DiagramItem::Step, contextMenu);\n    QSizeF newSize(200, 150);\n    item.setFixedSize(newSize);\n    QCOMPARE(item.m_grapSize, newSize);\n}\n\nvoid TestDiagramItem::testDiagramTypeEnum()\n{\n    QCOMPARE(static_cast<int>(DiagramItem::StartEnd), 0);\n    QCOMPARE(static_cast<int>(DiagramItem::Conditional), 1);\n    QCOMPARE(static_cast<int>(DiagramItem::Step), 2);\n    QCOMPARE(static_cast<int>(DiagramItem::circular), 3);\n    QCOMPARE(static_cast<int>(DiagramItem::Document), 4);\n    QCOMPARE(static_cast<int>(DiagramItem::PredefinedProcess), 5);\n    QCOMPARE(static_cast<int>(DiagramItem::StoredData), 6);\n}\n\nvoid TestDiagramItem::testRotationAngle()\n{\n    DiagramItem item(DiagramItem::Step, contextMenu);\n    item.setRotationAngle(45);\n    QCOMPARE(item.rotationAngle(), 45);\n    item.setRotationAngle(-30);\n    QCOMPARE(item.rotationAngle(), -30);\n}\n\nQTEST_MAIN(TestDiagramItem)\n#include \"test_diagramitem.moc\"\n"
        },
        {
          "path": "tests/generated/test_deletecommand.cpp",
          "content": "#include <QtTest>\n#include <QGraphicsScene>\n#include <QGraphicsRectItem>\n#include \"../deletecommand.h\"\n\nclass TestDeleteCommand : public QObject\n{\n    Q_OBJECT\n\nprivate slots:\n    void initTestCase();\n    void cleanupTestCase();\n    void testConstructor();\n    void testUndoRedo();\n\nprivate:\n    QGraphicsScene *scene;\n    QGraphicsRectItem *testItem;\n};\n\nvoid TestDeleteCommand::initTestCase()\n{\n    scene = new QGraphicsScene();\n    testItem = new QGraphicsRectItem(0, 0, 100, 100);\n    scene->addItem(testItem);\n}\n\nvoid TestDeleteCommand::cleanupTestCase()\n{\n    delete scene;\n}\n\nvoid TestDeleteCommand::testConstructor()\n{\n    DeleteCommand cmd(testItem, scene);\n    QVERIFY(cmd.m_item == testItem);\n    QVERIFY(cmd.m_scene == scene);\n    QCOMPARE(cmd.m_itemPos, testItem->pos());\n    QCOMPARE(cmd.m_itemSize, testItem->boundingRect().size());\n}\n\nvoid TestDeleteCommand::testUndoRedo()\n{\n    // 初始状态：item 在场景中\n    QVERIFY(scene->items().contains(testItem));\n    \n    DeleteCommand cmd(testItem, scene);\n    \n    // 执行 redo: 移除 item\n    cmd.redo();\n    QVERIFY(!scene->items().contains(testItem));\n    \n    // 执行 undo: 恢复 item\n    cmd.undo();\n    QVERIFY(scene->items().contains(testItem));\n    QCOMPARE(testItem->pos(), cmd.m_itemPos);\n}\n\nQTEST_MAIN(TestDeleteCommand)\n#include \"test_deletecommand.moc\"\n"
        },
        {
          "path": "tests/generated/test_diagrampath.cpp",
          "content": "#include <QtTest>\n#include <QGraphicsScene>\n#include <QMenu>\n#include \"../diagramitem.h\"\n#include \"../diagrampath.h\"\n\nclass TestDiagramPath : public QObject\n{\n    Q_OBJECT\n\nprivate slots:\n    void initTestCase();\n    void cleanupTestCase();\n    void testConstructor();\n    void testQuadFunction();\n    void testGetStartEndItem();\n\nprivate:\n    QGraphicsScene *scene;\n    QMenu *contextMenu;\n    DiagramItem *startItem;\n    DiagramItem *endItem;\n};\n\nvoid TestDiagramPath::initTestCase()\n{\n    scene = new QGraphicsScene();\n    contextMenu = new QMenu();\n    startItem = new DiagramItem(DiagramItem::Step, contextMenu);\n    endItem = new DiagramItem(DiagramItem::Conditional, contextMenu);\n    scene->addItem(startItem);\n    scene->addItem(endItem);\n    startItem->setPos(0, 0);\n    endItem->setPos(200, 200);\n}\n\nvoid TestDiagramPath::cleanupTestCase()\n{\n    delete scene;\n    delete contextMenu;\n}\n\nvoid TestDiagramPath::testConstructor()\n{\n    DiagramPath path(startItem, endItem, DiagramItem::TF_Right, DiagramItem::TF_Left);\n    QVERIFY(path.startItem == startItem);\n    QVERIFY(path.endItem == endItem);\n    QVERIFY(path.startState == DiagramItem::TF_Right);\n    QVERIFY(path.endState == DiagramItem::TF_Left);\n    QVERIFY(path.m_state > 0); // 应计算出一个状态值\n}\n\nvoid TestDiagramPath::testQuadFunction()\n{\n    // 测试四个象限\n    QCOMPARE(DiagramPath::quad(QPointF(10, 10), QPointF(20, 20)), 2); // 右下\n    QCOMPARE(DiagramPath::quad(QPointF(20, 20), QPointF(10, 10)), 4); // 左上\n    QCOMPARE(DiagramPath::quad(QPointF(20, 10), QPointF(10, 20)), 3); // 左下\n    QCOMPARE(DiagramPath::quad(QPointF(10, 20), QPointF(20, 10)), 1); // 右上\n}\n\nvoid TestDiagramPath::testGetStartEndItem()\n{\n    DiagramPath path(startItem, endItem, DiagramItem::TF_Top, DiagramItem::TF_Bottom);\n    QCOMPARE(path.getStartItem(), startItem);\n    QCOMPARE(path.getEndItem(), endItem);\n}\n\nQTEST_MAIN(TestDiagramPath)\n#include \"test_diagrampath.moc\"\n"
        },
        {
          "path": "tests/generated/test_findreplacedialog.cpp",
          "content": "#include <QtTest>\n#include <QLineEdit>\n#include <QPushButton>\n#include <QVBoxLayout>\n#include \"../findreplacedialog.h\"\n\nclass TestFindReplaceDialog : public QObject\n{\n    Q_OBJECT\n\nprivate slots:\n    void initTestCase();\n    void cleanupTestCase();\n    void testConstructor();\n    void testFindSignal();\n    void testReplaceSignal();\n    void testReplaceAllSignal();\n\nprivate:\n    FindReplaceDialog *dialog;\n    QString lastFindText;\n    QString lastReplaceText;\n    QString lastReplaceAllText;\n\nprivate slots:\n    void handleFind(const QString &text) { lastFindText = text; }\n    void handleReplace(const QString &find, const QString &replace) { lastReplaceText = find + \"->\" + replace; }\n    void handleReplaceAll(const QString &find, const QString &replace) { lastReplaceAllText = find + \"->\" + replace; }\n};\n\nvoid TestFindReplaceDialog::initTestCase()\n{\n    dialog = new FindReplaceDialog();\n    connect(dialog, &FindReplaceDialog::findText, this, &TestFindReplaceDialog::handleFind);\n    connect(dialog, &FindReplaceDialog::replaceText, this, &TestFindReplaceDialog::handleReplace);\n    connect(dialog, &FindReplaceDialog::replaceAllText, this, &TestFindReplaceDialog::handleReplaceAll);\n}\n\nvoid TestFindReplaceDialog::cleanupTestCase()\n{\n    delete dialog;\n}\n\nvoid TestFindReplaceDialog::testConstructor()\n{\n    QVERIFY(dialog->findLineEdit != nullptr);\n    QVERIFY(dialog->replaceLineEdit != nullptr);\n    QVERIFY(dialog->findButton != nullptr);\n    QVERIFY(dialog->replaceButton != nullptr);\n    QVERIFY(dialog->replaceAllButton != nullptr);\n    \n    // 检查布局\n    QVBoxLayout *layout = qobject_cast<QVBoxLayout*>(dialog->layout());\n    QVERIFY(layout != nullptr);\n}\n\nvoid TestFindReplaceDialog::testFindSignal()\n{\n    dialog->findLineEdit->setText(\"testFind\");\n    QTest::mouseClick(dialog->findButton, Qt::LeftButton);\n    QCOMPARE(lastFindText, QString(\"testFind\"));\n}\n\nvoid TestFindReplaceDialog::testReplaceSignal()\n{\n    dialog->findLineEdit->setText(\"old\");\n    dialog->replaceLineEdit->setText(\"new\");\n    QTest::mouseClick(dialog->replaceButton, Qt::LeftButton);\n    QCOMPARE(lastReplaceText, QString(\"old->new\"));\n}\n\nvoid TestFindReplaceDialog::testReplaceAllSignal()\n{\n    dialog->findLineEdit->setText(\"findAll\");\n    dialog->replaceLineEdit->setText(\"replaceAll\");\n    QTest::mouseClick(dialog->replaceAllButton, Qt::LeftButton);\n    QCOMPARE(lastReplaceAllText, QString(\"findAll->replaceAll\"));\n}\n\nQTEST_MAIN(TestFindReplaceDialog)\n#include \"test_findreplacedialog.moc\"\n"
        }
      ],
      "stats": {
        "files_generated": 8,
        "cases_approx": 26
      }
    },
    "applied": [
      "tests/generated/test_diagram_items.cpp (8 cases)",
      "tests/generated/test_diagram_items.pro (0 cases)",
      "tests/generated/test_commands.cpp (3 cases)",
      "tests/generated/tests.pro (0 cases)",
      "tests/generated/test_diagramitem.cpp (6 cases)",
      "tests/generated/test_deletecommand.cpp (2 cases)",
      "tests/generated/test_diagrampath.cpp (3 cases)",
      "tests/generated/test_findreplacedialog.cpp (4 cases)"
    ],
    "total_cases_count": 26
  },
  "findings": [
    {
      "category": "testgen",
      "severity": "info",
      "title": "已生成 QtTest：8 个文件，共约 26 个用例",
      "details": "生成文件明细：\ntests/generated/test_diagram_items.cpp (8 cases)\ntests/generated/test_diagram_items.pro (0 cases)\ntests/generated/test_commands.cpp (3 cases)\ntests/generated/tests.pro (0 cases)\ntests/generated/test_diagramitem.cpp (6 cases)\ntests/generated/test_deletecommand.cpp (2 cases)\ntests/generated/test_diagrampath.cpp (3 cases)\ntests/generated/test_findreplacedialog.cpp (4 cases)",
      "file": null,
      "line": null,
      "rule_id": null,
      "evidence": {}
    }
  ]
}